spring.application.name=APIGatewayLMS

############################################
# API Gateway: Core
############################################
server.port=8080

############################################
# Spring Cloud Gateway: Routes (Fixed URLs)
# - Adjust paths and ports as per your services
############################################


# USER service route
spring.cloud.gateway.routes[0].id=user-service
spring.cloud.gateway.routes[0].uri=http://localhost:8081
spring.cloud.gateway.routes[0].predicates[0]=Path=/api/users/**
spring.cloud.gateway.routes[0].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[0].filters[0].args.name=userServiceCB
spring.cloud.gateway.routes[0].filters[0].args.fallbackUri=forward:/fallback/user

# ENROLLMENT service route
spring.cloud.gateway.routes[1].id=enrollment-service
spring.cloud.gateway.routes[1].uri=http://localhost:8082
spring.cloud.gateway.routes[1].predicates[0]=Path=/api/enrollments/**
spring.cloud.gateway.routes[1].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[1].filters[0].args.name=enrollmentServiceCB
spring.cloud.gateway.routes[1].filters[0].args.fallbackUri=forward:/fallback/enrollment

# COURSE service route
spring.cloud.gateway.routes[2].id=course-service
spring.cloud.gateway.routes[2].uri=http://localhost:8083
spring.cloud.gateway.routes[2].predicates[0]=Path=/api/courses/**
spring.cloud.gateway.routes[2].filters[0].name=CircuitBreaker
spring.cloud.gateway.routes[2].filters[0].args.name=courseServiceCB
spring.cloud.gateway.routes[2].filters[0].args.fallbackUri=forward:/fallback/course

############################################
# Management Endpoints
############################################
management.endpoints.web.exposure.include=health,info

############################################
# Custom Fallback Messages (optional)
# If you bound GatewayFallbackProperties with @ConfigurationProperties(prefix="gateway.fallback")
############################################
gateway.fallback.user.message=User service is currently unavailable. Please try again later.
gateway.fallback.enrollment.message=Enrollment service is currently unavailable. Please try again later.
gateway.fallback.course.message=Course service is currently unavailable. Please try again later.

############################################
# Resilience4j CircuitBreaker Config
# Tune thresholds/timeouts as per your SLAs
############################################
resilience4j.circuitbreaker.instances.userServiceCB.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.userServiceCB.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.userServiceCB.slidingWindowSize=20
resilience4j.circuitbreaker.instances.userServiceCB.failureRateThreshold=50
resilience4j.circuitbreaker.instances.userServiceCB.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.userServiceCB.permittedNumberOfCallsInHalfOpenState=5
resilience4j.circuitbreaker.instances.userServiceCB.automaticTransitionFromOpenToHalfOpenEnabled=true

resilience4j.circuitbreaker.instances.enrollmentServiceCB.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.enrollmentServiceCB.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.enrollmentServiceCB.slidingWindowSize=20
resilience4j.circuitbreaker.instances.enrollmentServiceCB.failureRateThreshold=50
resilience4j.circuitbreaker.instances.enrollmentServiceCB.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.enrollmentServiceCB.permittedNumberOfCallsInHalfOpenState=5
resilience4j.circuitbreaker.instances.enrollmentServiceCB.automaticTransitionFromOpenToHalfOpenEnabled=true

resilience4j.circuitbreaker.instances.courseServiceCB.registerHealthIndicator=true
resilience4j.circuitbreaker.instances.courseServiceCB.slidingWindowType=COUNT_BASED
resilience4j.circuitbreaker.instances.courseServiceCB.slidingWindowSize=20
resilience4j.circuitbreaker.instances.courseServiceCB.failureRateThreshold=50
resilience4j.circuitbreaker.instances.courseServiceCB.waitDurationInOpenState=10s
resilience4j.circuitbreaker.instances.courseServiceCB.permittedNumberOfCallsInHalfOpenState=5
resilience4j.circuitbreaker.instances.courseServiceCB.automaticTransitionFromOpenToHalfOpenEnabled=true

############################################
# Resilience4j TimeLimiter (per CB)
############################################
resilience4j.timelimiter.instances.userServiceCB.timeoutDuration=3s
resilience4j.timelimiter.instances.enrollmentServiceCB.timeoutDuration=3s
resilience4j.timelimiter.instances.courseServiceCB.timeoutDuration=3s

############################################
# (Optional) Using Eureka/Service Discovery
# - Uncomment and adjust if you route with lb://SERVICE-ID
############################################
# spring.cloud.gateway.routes[0].uri=lb://USER-MICROSERVICE
# spring.cloud.gateway.routes[1].uri=lb://ENROLLMENT-MICROSERVICE
# spring.cloud.gateway.routes[2].uri=lb://COURSE-MICROSERVICE
# eureka.client.serviceUrl.defaultZone=http://localhost:8761/eureka/
# eureka.client.register-with-eureka=true
# eureka.client.fetch-registry=true

spring.datasource.driver-class-name=org.postgresql.Driver
spring.datasource.url=jdbc:postgresql://localhost:5432/spring_db
spring.datasource.username=postgres
spring.datasource.password=Pranit2105@


# Do NOT use Spring Cloud Config unless you intend to; keep disabled
spring.cloud.config.enabled=false

# If any discovery client libs exist on classpath, disable them
spring.cloud.discovery.enabled=false

# If your gateway has no DB, exclude datasource auto-config (prevents JDBC errors)
spring.autoconfigure.exclude=org.springframework.boot.autoconfigure.jdbc.DataSourceAutoConfiguration

